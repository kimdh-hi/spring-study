## Spring core

### 빈 스코프
스프링 빈이 스프링 컨테이너에서 존재할 수 있는 범위를 말한다.<br/>

기본적으로 빈을 생성하게 도면 싱글톤 스코프를 갖는다. <br/>
싱글톤 스코프의 경우 스프링 컨테이너와 생명주기가 같다. <br/>

#### 프로토타입 스코프
스프링 빈을 등록하면 기본적으로 싱글톤으로 생성되기 때문에 스프링 컨테이너 내 해당 빈은 단 한 개임을 보장한다.<br/>
`프로토타입 스코프`의 경우 빈 요청시 `매 번 새로운 객체가 반환`된다.<br/>
스프링 컨테이너는 요청된 빈을 생성하고, 초기화해주고, 주입까지만 수행한다. <br/>

싱글톤 빈과 달리 주입을 마치고 난 뒤 스프링 컨테이너는 더 이상 해당 빈에 대해 관여하지 않는다.<br/>
즉, 소멸과 같은 후처리들을 직접 관리해야 한다. <br/>

```
테스트
- 여러 번 프로토타입 스코프 빈을 생성해보고 참조 값이 다른 것을 확인
- `@PreDestry` 로 로그찍고 애플리케이션 종료시키면 로그가 찍히지 않는 것을 테스트
```

#### 주의
싱글톤 스코프 빈에서 프로토타입 스코프 빈을 사용하는 경우 주의가 필요하다.<br/>
싱글톤 스코프 빈 내에서 프로토타입 스코프 빈을 사용하는 경우 프로토타입 스코프 빈이기 때문에 매 번 새로운 객체가 반환될 것이라 예상한다.<br/>
하지만 프로토타입 스코프 빈은 예상한 것처럼 새로운 빈을 만들어내지 않고 싱글톤 빈 생성 시점에 생성된 빈을 그대로 사용하게 된다.<br/>

싱글톤 빈 내에서 프로토타입 빈 사용시 매 번 새로운 빈 객체를 얻고 싶다면 <br/>
- `ObjectProvider`
- `JSR-330 Provider`

를 사용하자. <br/>

---

### 빈 생명주기 콜백

빈이 생성되고 소멸될 때 콜백을 받을 수 있는 세 가지 방법이 있다.<br/>

#### 인터페이스 방식 (InitializingBean, DisposableBean)
- InitializingBean => afterPropertiesSet 메서드 구현
- DisposableBean => destroy 메서드 구현
- 스프링 초창기 사용하던 방법이다. 특별한 이유가 없다면 사용할 이유가 없다.

#### 빈 등록시 initMethod, destroyMethod 지정
```kotlin
@Bean(initMode = "initMethodName", destroyMethod = "destroyMethodName")
```
- 구현 메서드, 메서드 이름 등에 제약이 없으므로 유연하다.
- `destroyMethod` 의 경우 `close`, `shutdown` 이라는 이름의 메서드로 사용한다면 따로 destroyMethod 를 설정하지 않아도 된다. (추론)
  - 위와 같은 추론기능을 사용하기 싫다면 (close, shutdown 이름의 메서드를 다르게 사용하고 싶다면) `destroyMethod=""` 공백으로 지정하면 된다.

#### @PostConstruct, @PreDestroy
- 가장 권장하는 방법

---

### 두 개 이상 같은 타입의 빈 주입
조회 대상 타입의 빈이 2개 이상인 경우 아래 방법으로 해결한다.<br/>

@Autowired
- 우선 타입을 보고 주입 대상 빈을 찾는다. <br/>
- 같은 타입의 빈이 2개 이상이라면 필드명 또는 파라미터명 (생성자 주입시 생성자 파라미터) 으로 주입 대상 빈을 결정한다. <br/>

@Qualifier
- 빈의 이름을 지정(변경)하는 것은 아님.
- `@Qualifier` 를 지정해서 빈 등록시 `@Qualifier` 로 찾아서 주입받을 수 있다.
- `@Qualifier` 로 빈을 주입받는 경우 해당 타입의 `@Qualifier` 가 지정된 빈을 찾지 뭇 한다면 `@Qualifier` 의 파라미터 명으로 빈 매칭을 시도하긴 하지만 이 방식은 권장하지 않는다.

@Primary
- 동일한 타입의 빈이 여러 개 존재할 때 우선권을 갖는 빈을 명시한다.

---

### @Configuration 클래스 내에서 @Bean 을 등록하는 이유

@Configuration 내에서 @Bean 을 등록하고 해당 bean 을 다른 빈에 주입해서 사용하는 경우 싱글톤을 보장한다. <br/>
@Configuration 내에서 bean 재사용? 재호출? 시 프록시 패턴이 적용되어 주입 전 해당 빈이 이미 생성되었는지를 한 번 확인하는 과정을 거치게 된다.<br/> 

만약 @Configuration 내에서 등록되는 bean 메서드를 호출시마다 새로운 객체로 받고 싶다면 `@Configuration(proxyBeanMethods = false)` 를 명시하면 된다.<br/>


### 참고
https://mangkyu.tistory.com/234

---
